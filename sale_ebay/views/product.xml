<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data>
    <!-- Wizzard to link existing listing with existing product -->
    <record model="ir.ui.view" id="ebay_link_listing_view">
      <field name="name">ebay.link.listing.form</field>
      <field name="model">ebay.link.listing</field>
      <field name="arch" type="xml">
        <form string="Link Existing Listing">
          <group>
            <field name="ebay_id"/>
          </group>
          <footer>
            <button name="link_listing" type="object" string="Link Listing" class="oe_highlight"/>
            or
            <button string="Cancel" class="oe_link" special="cancel" />
          </footer>
        </form>
      </field>
    </record>

    <record model="ir.actions.act_window" id="action_ebay_link_listing">
      <field name="name">Link Existing Listing</field>
      <field name="res_model">ebay.link.listing</field>
      <field name="view_type">form</field>
      <field name="view_mode">form</field>
      <field name="view_id" ref="ebay_link_listing_view"/>
      <field name="target">new</field>
    </record>

    <record id="product_template_sale_ebay_form_view" model="ir.ui.view">
      <field name="name">product.sale.ebay.form</field>
      <field name="model">product.template</field>
      <field name="inherit_id" ref="stock.product_template_form_view_procurement_button"/>
      <field name="arch" type="xml">
        <data>
        <xpath expr="//header" position="inside">
            <button name="push_product_ebay" type="object" string="List Item" attrs="{'invisible': ['|', ('ebay_use', '=', False), ('ebay_listing_status', 'in', ['Active', 'Out Of Stock'])]}"/>
            <button name="relist_product_ebay" type="object" string="Relist Item" attrs="{'invisible': ['|', ('ebay_use', '=', False), ('ebay_listing_status','not in', ['Ended', 'Completed', 'Out Of Stock'])]}"/>
            <button name="revise_product_ebay" type="object" string="Revise Item" attrs="{'invisible': ['|', ('ebay_use', '=', False), '|',('ebay_url','=', False),('ebay_listing_status','not in', ['Active', 'Out Of Stock'])]}"/>
            <button name="end_listing_product_ebay" type="object" string="End Item's Listing" attrs="{'invisible': ['|', ('ebay_use', '=', False), '|',('ebay_url','=', False),'|',('ebay_listing_status','!=','Active'),('ebay_listing_status','=','Out Of Stock')]}"/>
            <button name="%(action_ebay_link_listing)d" type='action' string='Link With Existing Listing' attrs="{'invisible': ['|',('ebay_use', '=', False),('ebay_listing_status','!=', 'Unlisted')]}"/>
        </xpath>
        <div name="options" position="inside">
          <div>          
            <field name="ebay_use"/>
            <label for="ebay_use"/>
          </div>
        </div>
        <notebook position="inside">
          <page string="eBay Sale" name="ebay_sale" attrs="{'invisible':[('ebay_use','=',False)]}">
            <group>
              <field name="ebay_url" readonly="True" attrs="{'invisible': [('ebay_url','=', False)]}" widget="url"/>
              <field name="ebay_listing_status"/>
              <field name="ebay_quantity_sold" attrs="{'invisible': ['|',('product_variant_count', '>', 1),('ebay_listing_status','=', 'Unlisted')]}"/>
              <field name="ebay_start_date" attrs="{'invisible': [('ebay_listing_status','=', 'Unlisted')]}"/>
            </group>
            
            <group colspan="2">
              <group>
                <field name="ebay_title"/>
                <field name="ebay_subtitle"/>
                <field name="ebay_category_id" options="{'no_create': True, 'no_open': True}"/>
                <field name="ebay_store_category_id" options="{'no_create': True, 'no_open': True}"/>
                <field name="ebay_store_category_2_id" attrs="{'invisible': [('ebay_store_category_id', '=', False)]}" options="{'no_create': True, 'no_open': True}"/>
                <field name="ebay_item_condition_id" options="{'no_create': True, 'no_open': True}"/>
              </group>
              <group>
                <field name="ebay_listing_type"/>
                <field name="ebay_price" attrs="{'invisible': [('ebay_listing_type','=', 'FixedPriceItem')]}" widget="monetary"/>
                <field name="ebay_buy_it_now_price" attrs="{'invisible': [('ebay_listing_type','=', 'FixedPriceItem')]}" widget="monetary"/>
                <field name="ebay_fixed_price" attrs="{'invisible': ['|',('ebay_listing_type','=', 'Chinese'),('product_variant_count', '>', 1)]}" widget="monetary"/>
                <field name="ebay_sync_stock" attrs="{'invisible': [('ebay_listing_type','=', 'Chinese')]}"/>
                <field name="ebay_quantity" attrs="{'invisible': ['|',('ebay_sync_stock','=',True),'|',('product_variant_count','>',1),('ebay_listing_type','=', 'Chinese')]}"/>
                <field name="ebay_listing_duration"/>
                <field name="ebay_best_offer"/>
                <field name="ebay_private_listing"/>

              </group>
              <group name="ebay_policies">
                <field name="ebay_seller_payment_policy_id" options="{'no_create': True, 'no_open': True}"/>
                <field name="ebay_seller_return_policy_id" options="{'no_create': True, 'no_open': True}"/>
                <field name="ebay_seller_shipping_policy_id" options="{'no_create': True, 'no_open': True}"/>
              </group>
            </group>

            <label for="product_variant_ids" 
              attrs="{'invisible': ['|',('ebay_listing_type','=', 'Chinese'),('product_variant_count', '=', 1)]}"/>
            <field name="product_variant_ids" widget="one2many_list" 
              attrs="{'invisible': ['|',('ebay_listing_type','=', 'Chinese'),('product_variant_count', '=', 1)]}">
              <tree string="Variants" editable="bottom" create="false" delete="false">
                <field name="currency_id" invisible="1"/>
                <field name="attribute_value_ids" widget="many2many_tags"/>
                <field name="ebay_use"/>
                <field name="ebay_fixed_price" widget="monetary"/>
                <field name="ebay_quantity"/>
                <field name="virtual_available"/>
                <field name="ebay_quantity_sold"/>
              </tree>
            </field>
            <label for="ebay_description"/>
            <field name="ebay_description" placeholder="Describe the product characteristics..."/>
          </page>
        </notebook>
        </data>
      </field>
    </record>

    <!-- server actions to add option in the menu "More" -->
    <record id="action_list_items" model="ir.actions.server">
      <field name="name">List Items</field>
      <field name="model_id" ref="sale.model_product_template"/>
      <field name="state">code</field>
      <field name="code">
        if context.get('active_model') == 'product.template':
          ids = []
          if(context['active_ids']):
              ids = context['active_ids']
          else:
              ids = context['active_id']
          self.push_product_ebay(cr, uid, ids, context=context)
      </field>
    </record>

    <record id="value_list_items" model="ir.values">
      <field name="key2" eval="'client_action_multi'"/>
      <field name="model" eval="'product.template'"/>
      <field name="name">List Items</field>
      <field name="value" eval="'ir.actions.server,%d'%action_list_items"/>
    </record>

    <record id="action_revise_items" model="ir.actions.server">
      <field name="name">Revise Items</field>
      <field name="model_id" ref="sale.model_product_template"/>
      <field name="state">code</field>
      <field name="code">
        if context.get('active_model') == 'product.template':
          ids = []
          if(context['active_ids']):
              ids = context['active_ids']
          else:
              ids = context['active_id']
          self.revise_product_ebay(cr, uid, ids, context=context)
      </field>
    </record>

    <record id="value_revise_items" model="ir.values">
      <field name="key2" eval="'client_action_multi'"/>
      <field name="model" eval="'product.template'"/>
      <field name="name">Revise Items</field>
      <field name="value" eval="'ir.actions.server,%d'%action_revise_items"/>
    </record>

    <record id="action_relist_items" model="ir.actions.server">
      <field name="name">Relist Items</field>
      <field name="model_id" ref="sale.model_product_template"/>
      <field name="state">code</field>
      <field name="code">
        if context.get('active_model') == 'product.template':
          ids = []
          if(context['active_ids']):
              ids = context['active_ids']
          else:
              ids = context['active_id']
          self.relist_product_ebay(cr, uid, ids, context=context)
      </field>
    </record>

    <record id="value_relist_items" model="ir.values">
      <field name="key2" eval="'client_action_multi'"/>
      <field name="model" eval="'product.template'"/>
      <field name="name">Relist Items</field>
      <field name="value" eval="'ir.actions.server,%d'%action_relist_items"/>
    </record>

    <record id="action_end_items_listings" model="ir.actions.server">
      <field name="name">End Items' Listings</field>
      <field name="model_id" ref="sale.model_product_template"/>
      <field name="state">code</field>
      <field name="code">
        if context.get('active_model') == 'product.template':
          ids = []
          if(context['active_ids']):
              ids = context['active_ids']
          else:
              ids = context['active_id']
          self.end_listing_product_ebay(cr, uid, ids, context=context)
      </field>
    </record>

    <record id="value_end_items_listings" model="ir.values">
      <field name="key2" eval="'client_action_multi'"/>
      <field name="model" eval="'product.template'"/>
      <field name="name">End Items' Listings</field>
      <field name="value" eval="'ir.actions.server,%d'%action_end_items_listings"/>
    </record>

  </data>
</openerp>
